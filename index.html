<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IronMusic - Rock Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Metal+Mania&family=Inter:wght@400;600;800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            color: white;
            overflow-x: hidden;
        }

        .rock-font {
            font-family: 'Metal Mania', cursive;
        }

        .glass-nav {
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .bg-wallpaper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0.5;
            /* AUMENTADO para 0.5 */
            z-index: 0;
            transition: opacity 0.5s ease;
        }

        .bg-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            /* REDUZIDO para 30% */
            z-index: 1;
        }

        .bg-yellow {
            background-image: url('https://wallpapercave.com/wp/ZA2hmZU.jpg');
        }

        .bg-purple {
            background-image: url('https://www.portaldoinferno.com.br/wp-content/uploads/2020/06/wallpaper-iron-maiden-the-final-frontier-4k-download.jpg');
        }

        .bg-green {
            background-image: url('https://i.pinimg.com/1200x/f6/4b/57/f64b573b709235d4aefc07ba709fd877.jpg');
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .spin-slow {
            animation: spin 10s linear infinite;
        }

        .music-card {
            transition: all 0.3s ease;
        }

        .music-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Progress bar styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            margin-top: -5px;
        }

        input[type="range"]::-webkit-slider-runnable-track {
            height: 4px;
            border-radius: 2px;
        }

        /* Vinyl Disc Effect */
        .vinyl-disc {
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5), inset 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .vinyl-disc::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30%;
            height: 30%;
            background: radial-gradient(circle, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.5) 50%, transparent 70%);
            border-radius: 50%;
            z-index: 1;
        }

        .vinyl-disc::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-conic-gradient(from 0deg,
                    rgba(255, 255, 255, 0.03) 0deg,
                    rgba(255, 255, 255, 0.03) 2deg,
                    transparent 2deg,
                    transparent 4deg);
            border-radius: 50%;
            pointer-events: none;
        }

        /* Context Menu */
        .context-menu {
            position: fixed;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 4px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            min-width: 150px;
        }

        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .context-menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .context-menu-item.danger {
            color: #ef4444;
        }

        .context-menu-item.danger:hover {
            background: rgba(239, 68, 68, 0.2);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDCmlwWC1GH5CUa2ZdiPGqBccAfPkUiTp8",
            authDomain: "ironmusic-73c33.firebaseapp.com",
            projectId: "ironmusic-73c33",
            storageBucket: "ironmusic-73c33.firebasestorage.app",
            messagingSenderId: "381707229330",
            appId: "1:381707229330:web:9d52be0330255472c72e4b"
        };

        const GEMINI_API_KEY = "AIzaSyDKszV0GsFp9hlTexYgyQKnrVfeNg9bO7A";
        const YOUTUBE_API_KEY = "AIzaSyBkKxlcuOU5Q6MU7ma9lAW9WHTr2Fth4JQ";

        let db = null;
        try {
            if (typeof firebase !== 'undefined' && firebase.apps.length === 0) {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
            }
        } catch (e) {
            console.error("Firebase error:", e);
        }

        const Icons = {
            Home: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="7" height="7" x="3" y="3" rx="1" /><rect width="7" height="7" x="14" y="3" rx="1" /><rect width="7" height="7" x="14" y="14" rx="1" /><rect width="7" height="7" x="3" y="14" rx="1" /></svg>,
            Search: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></svg>,
            Play: (p) => <svg {...p} viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3" /></svg>,
            Pause: (p) => <svg {...p} viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></svg>,
            Skip: (p) => <svg {...p} viewBox="0 0 24 24" fill="currentColor"><polygon points="5 4 15 12 5 20 5 4" /><line x1="19" y1="5" x2="19" y2="19" stroke="currentColor" strokeWidth="2" /></svg>,
            SkipBack: (p) => <svg {...p} viewBox="0 0 24 24" fill="currentColor"><polygon points="19 20 9 12 19 4 19 20" /><line x1="5" y1="19" x2="5" y2="5" stroke="currentColor" strokeWidth="2" /></svg>,
            ThumbsUp: ({ filled, ...p }) => <svg {...p} viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2"><path d="M7 22V11M2 13v6a2 2 0 0 0 2 2h12.5a2.5 2.5 0 0 0 2.5-2.5v-6a2.5 2.5 0 0 0-2.5-2.5H10l1.5-6a2 2 0 0 0-2-2 2 2 0 0 0-2 2L7 11H4a2 2 0 0 0-2 2Z" /></svg>,
            Guitar: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m11.9 12.1 4.514-4.514" /><path d="M20.1 2.3a1 1 0 0 0-1.4 0l-1.114 1.114A2 2 0 0 0 17 4.828v1.344a2 2 0 0 1-.586 1.414A2 2 0 0 1 17.828 7h1.344a2 2 0 0 0 1.414-.586L21.7 5.3a1 1 0 0 0 0-1.4z" /><path d="m6 16 2 2" /><path d="M8.2 9.9C8.7 8.8 9.8 8 11 8c2.8 0 5 2.2 5 5 0 1.2-.8 2.3-1.9 2.8l-.9.4A2 2 0 0 0 12 18a4 4 0 0 1-4 4c-3.3 0-6-2.7-6-6a4 4 0 0 1 4-4 2 2 0 0 0 1.8-1.2z" /><circle cx="11.5" cy="12.5" r=".5" fill="currentColor" /></svg>,
            ABC: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 7V5c0-1.1.9-2 2-2h2" /><path d="M17 3h2c1.1 0 2 .9 2 2v2" /><path d="M21 17v2c0 1.1-.9 2-2 2h-2" /><path d="M7 21H5c-1.1 0-2-.9-2-2v-2" /><path d="M7 8h8" /><path d="M7 12h10" /><path d="M7 16h6" /></svg>,
            ChevronDown: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m6 9 6 6 6-6" /></svg>,
            Volume: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><path d="M15.54 8.46a5 5 0 0 1 0 7.07" /></svg>
        };

        function App() {
            const [view, setView] = useState('home');
            const [activeTheme, setActiveTheme] = useState('yellow');
            const [currentTrack, setCurrentTrack] = useState(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const [currentTime, setCurrentTime] = useState(0);
            const [duration, setDuration] = useState(0);
            const [volume, setVolume] = useState(80);
            const [showFullScreenPlayer, setShowFullScreenPlayer] = useState(false);
            const [musicLibrary, setMusicLibrary] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [homeTab, setHomeTab] = useState('all');
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [selectedAlbum, setSelectedAlbum] = useState(null);
            const [albumTracks, setAlbumTracks] = useState([]);
            const [loading, setLoading] = useState(false);
            const [loadingTracks, setLoadingTracks] = useState(false);
            const [bandInfo, setBandInfo] = useState(null);
            const [showBandInfo, setShowBandInfo] = useState(false);
            const [lyrics, setLyrics] = useState(null);
            const [loadingLyrics, setLoadingLyrics] = useState(false);
            const [contextMenu, setContextMenu] = useState(null);

            const youtubeRef = useRef(null);

            useEffect(() => {
                loadMusicLibrary();

                // Close context menu on click outside
                const handleClick = () => setContextMenu(null);
                document.addEventListener('click', handleClick);
                return () => document.removeEventListener('click', handleClick);
            }, []);

            const loadMusicLibrary = async () => {
                if (!db) return;
                try {
                    const snapshot = await db.collection('song_cache').orderBy('createdAt', 'desc').limit(50).get();
                    const songs = [];
                    snapshot.forEach(doc => {
                        songs.push({ id: doc.id, ...doc.data() });
                    });
                    setMusicLibrary(songs);
                } catch (e) {
                    console.error(e);
                }
            };

            const handlePlay = (track, index = 0) => {
                setCurrentTrack(track);
                setCurrentIndex(index);
                setShowFullScreenPlayer(true);
                setIsPlaying(true);
            };

            const playNext = () => {
                if (musicLibrary.length === 0) return;
                const nextIndex = (currentIndex + 1) % musicLibrary.length;
                handlePlay(musicLibrary[nextIndex], nextIndex);
            };

            const playPrevious = () => {
                if (musicLibrary.length === 0) return;
                const prevIndex = currentIndex === 0 ? musicLibrary.length - 1 : currentIndex - 1;
                handlePlay(musicLibrary[prevIndex], prevIndex);
            };

            const toggleLike = async (e, track) => {
                e.stopPropagation();
                const newLiked = !track.liked;
                if (db) {
                    await db.collection('song_cache').doc(track.id).update({ liked: newLiked });
                }
                loadMusicLibrary();
            };

            const handleContextMenu = (e, track) => {
                e.preventDefault();
                e.stopPropagation();
                setContextMenu({
                    x: e.clientX,
                    y: e.clientY,
                    track: track
                });
            };

            const deleteTrack = async (track) => {
                if (!confirm(`Excluir "${track.title}" de ${track.artist}?`)) return;

                try {
                    if (db) {
                        await db.collection('song_cache').doc(track.id).delete();
                    }

                    // If currently playing, stop it
                    if (currentTrack?.id === track.id) {
                        setCurrentTrack(null);
                        setShowFullScreenPlayer(false);
                        setIsPlaying(false);
                    }

                    loadMusicLibrary();
                    setContextMenu(null);
                } catch (e) {
                    console.error('Erro ao excluir:', e);
                    alert('Erro ao excluir m√∫sica');
                }
            };

            const searchMusic = async () => {
                if (!searchQuery) return;
                setLoading(true);
                setSelectedAlbum(null);
                try {
                    const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(searchQuery)}&entity=album&limit=20`);
                    const data = await res.json();
                    if (data.results) {
                        setSearchResults(data.results.map(r => ({
                            name: r.collectionName,
                            artist: r.artistName,
                            artwork: r.artworkUrl100.replace('100x100', '600x600'),
                            collectionId: r.collectionId
                        })));
                    }
                } catch (e) {
                    console.error(e);
                } finally {
                    setLoading(false);
                }
            };

            const fetchAlbumTracks = async (album) => {
                setSelectedAlbum(album);
                setLoadingTracks(true);
                try {
                    const res = await fetch(`https://itunes.apple.com/lookup?id=${album.collectionId}&entity=song`);
                    const data = await res.json();
                    if (data.results && data.results.length > 1) {
                        const tracks = data.results.slice(1).map(track => ({
                            name: track.trackName,
                            artist: track.artistName,
                            artwork: album.artwork,
                            trackNumber: track.trackNumber
                        }));
                        setAlbumTracks(tracks);
                    }
                } catch (e) {
                    console.error(e);
                } finally {
                    setLoadingTracks(false);
                }
            };

            const selectTrack = async (track) => {
                try {
                    const searchQuery = `${track.artist} ${track.name} official audio`;
                    const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=id&q=${encodeURIComponent(searchQuery)}&key=${YOUTUBE_API_KEY}&type=video&videoEmbeddable=true&maxResults=1`);
                    const data = await res.json();

                    if (data.items && data.items.length > 0) {
                        const youtubeId = data.items[0].id.videoId;
                        const newTrack = { ...track, youtubeId };

                        if (db) {
                            const cacheKey = `ironmusic_${track.name}_${track.artist}`.toLowerCase().replace(/[^a-z0-9_]/g, '');
                            await db.collection('song_cache').doc(cacheKey).set({
                                title: track.name,
                                artist: track.artist,
                                youtubeId: youtubeId,
                                artwork: track.artwork,
                                createdAt: new Date()
                            });
                        }

                        loadMusicLibrary();
                        handlePlay(newTrack);
                    }
                } catch (e) {
                    console.error(e);
                }
            };

            const fetchBandInfo = async (artist) => {
                try {
                    setShowBandInfo(true);
                    setBandInfo({ loading: true });
                    const prompt = `Informa√ß√µes sobre a banda ${artist}: Hist√≥ria, membros atuais e passados, anos de forma√ß√£o, principais √°lbuns com anos de lan√ßamento, curiosidades. M√°ximo 300 palavras em portugu√™s.`;
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await res.json();
                    const content = data.candidates?.[0]?.content?.parts?.[0]?.text || 'N√£o dispon√≠vel';
                    setBandInfo({ artist, content, loading: false });
                } catch (e) {
                    setBandInfo({ artist, content: 'Erro ao carregar', loading: false });
                }
            };

            const fetchLyrics = async (track) => {
                setLoadingLyrics(true);
                try {
                    const prompt = `Forne√ßa a letra completa da m√∫sica "${track.title}" de "${track.artist}" em JSON com duas propriedades: "original" (letra original) e "traducao" (tradu√ß√£o em portugu√™s). Se n√£o souber a letra exata, forne√ßa uma tradu√ß√£o aproximada baseada no tema da m√∫sica.`;
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await res.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '{}';
                    const jsonMatch = text.match(/\{[\s\S]*\}/);
                    const lyricsData = jsonMatch ? JSON.parse(jsonMatch[0]) : { original: 'N√£o dispon√≠vel', traducao: 'N√£o dispon√≠vel' };
                    setLyrics(lyricsData);
                } catch (e) {
                    setLyrics({ original: 'Erro ao carregar', traducao: 'Erro ao carregar' });
                } finally {
                    setLoadingLyrics(false);
                }
            };

            const getYoutubeEmbed = () => {
                if (!currentTrack?.youtubeId) return '';
                return `https://www.youtube.com/embed/${currentTrack.youtubeId}?autoplay=1&playsinline=1&rel=0&enablejsapi=1`;
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const themeColors = {
                yellow: 'text-yellow-500',
                purple: 'text-purple-500',
                green: 'text-green-500'
            };

            const groupedByArtist = musicLibrary.reduce((acc, song) => {
                const artist = song.artist || 'Desconhecido';
                if (!acc[artist]) acc[artist] = [];
                acc[artist].push(song);
                return acc;
            }, {});

            return (
                <div className="h-screen w-full flex flex-col relative">
                    <div className={`bg-wallpaper bg-${activeTheme}`}></div>
                    <div className="bg-overlay"></div>

                    <div className="flex justify-between items-center p-4 pt-8 z-10 relative">
                        <div className="flex items-center gap-3">
                            <i className="fas fa-guitar text-3xl text-yellow-500"></i>
                            <h1 className="text-3xl rock-font tracking-wider">
                                IRON<span className={themeColors[activeTheme]}>MUSIC</span>
                            </h1>
                        </div>
                        <div className="flex gap-2">
                            {['yellow', 'purple', 'green'].map(c => (
                                <button
                                    key={c}
                                    onClick={() => setActiveTheme(c)}
                                    className={`w-6 h-6 rounded-full bg-${c}-600 border-2 ${activeTheme === c ? 'border-white' : 'border-transparent'}`}
                                />
                            ))}
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto pb-36 px-4 z-10 relative">
                        {view === 'home' && (
                            <div className="space-y-6">
                                <div className="flex gap-2 bg-white/5 p-1 rounded-lg">
                                    <button onClick={() => setHomeTab('all')} className={`flex-1 py-2 rounded ${homeTab === 'all' ? 'bg-white/20' : ''}`}>Todas</button>
                                    <button onClick={() => setHomeTab('artist')} className={`flex-1 py-2 rounded ${homeTab === 'artist' ? 'bg-white/20' : ''}`}>Por Banda</button>
                                    <button onClick={() => setHomeTab('liked')} className={`flex-1 py-2 rounded ${homeTab === 'liked' ? 'bg-white/20' : ''}`}>Curtidas</button>
                                </div>

                                {homeTab === 'all' && (
                                    <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                        {musicLibrary.map((song, idx) => (
                                            <div
                                                key={song.id}
                                                onClick={() => handlePlay(song, idx)}
                                                onContextMenu={(e) => handleContextMenu(e, song)}
                                                className="music-card bg-white/5 p-3 rounded-lg cursor-pointer"
                                            >
                                                <img src={song.artwork} className="w-full aspect-square vinyl-disc mb-2 object-cover" alt={song.title} />
                                                <h4 className="font-bold text-sm truncate">{song.title}</h4>
                                                <p className="text-xs text-gray-400 truncate">{song.artist}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {homeTab === 'artist' && (
                                    <div className="space-y-8">
                                        {Object.entries(groupedByArtist).map(([artist, songs]) => (
                                            <div key={artist}>
                                                <h3 className="text-xl font-bold mb-4">{artist}</h3>
                                                <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                                    {songs.map((song, idx) => (
                                                        <div
                                                            key={song.id}
                                                            onClick={() => handlePlay(song, idx)}
                                                            onContextMenu={(e) => handleContextMenu(e, song)}
                                                            className="music-card bg-white/5 p-3 rounded-lg cursor-pointer"
                                                        >
                                                            <img src={song.artwork} className="w-full aspect-square vinyl-disc mb-2 object-cover" alt={song.title} />
                                                            <h4 className="font-bold text-sm truncate">{song.title}</h4>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {homeTab === 'liked' && (
                                    <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                        {musicLibrary.filter(s => s.liked).map((song, idx) => (
                                            <div
                                                key={song.id}
                                                onClick={() => handlePlay(song, idx)}
                                                onContextMenu={(e) => handleContextMenu(e, song)}
                                                className="music-card bg-white/5 p-3 rounded-lg cursor-pointer"
                                            >
                                                <img src={song.artwork} className="w-full aspect-square vinyl-disc mb-2 object-cover" alt={song.title} />
                                                <h4 className="font-bold text-sm truncate">{song.title}</h4>
                                                <p className="text-xs text-gray-400 truncate">{song.artist}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'search' && (
                            <div className="space-y-4">
                                <div className="relative">
                                    <input
                                        type="text"
                                        placeholder="Buscar artista, √°lbum..."
                                        value={searchQuery}
                                        onChange={e => setSearchQuery(e.target.value)}
                                        onKeyDown={e => e.key === 'Enter' && searchMusic()}
                                        className="w-full bg-white/10 border border-white/20 p-4 pl-12 rounded-full outline-none"
                                    />
                                    <Icons.Search className="absolute left-4 top-4 text-gray-400" width={20} />
                                    <button onClick={searchMusic} className="absolute right-2 top-2 bg-white/10 px-4 py-2 rounded-full">Buscar</button>
                                </div>

                                {loading && <div className="text-center py-8">Carregando...</div>}

                                {selectedAlbum ? (
                                    <div className="space-y-4">
                                        <button onClick={() => setSelectedAlbum(null)} className="text-gray-400 hover:text-white">‚Üê Voltar</button>
                                        <div className="flex items-center gap-4 mb-4">
                                            <img src={selectedAlbum.artwork} className="w-20 h-20 rounded-lg" alt={selectedAlbum.name} />
                                            <div>
                                                <h2 className="text-xl font-bold">{selectedAlbum.name}</h2>
                                                <p className="text-gray-400">{selectedAlbum.artist}</p>
                                            </div>
                                        </div>
                                        {loadingTracks && <div className="text-center py-8">Carregando m√∫sicas...</div>}
                                        {!loadingTracks && (
                                            <div className="space-y-2">
                                                {albumTracks.map((track, idx) => (
                                                    <div
                                                        key={idx}
                                                        onClick={() => selectTrack(track)}
                                                        className="bg-white/5 hover:bg-white/10 p-3 rounded-lg cursor-pointer flex items-center gap-3"
                                                    >
                                                        <span className="text-gray-500 w-6">{track.trackNumber}</span>
                                                        <div className="flex-1">
                                                            <h4 className="font-bold">{track.name}</h4>
                                                            <p className="text-xs text-gray-400">{track.artist}</p>
                                                        </div>
                                                        <span className="text-xs text-gray-500">‚ñ∂</span>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                        {searchResults.map((result, i) => (
                                            <div key={i} onClick={() => fetchAlbumTracks(result)} className="music-card bg-white/5 p-3 rounded-lg cursor-pointer">
                                                <img src={result.artwork} className="w-full aspect-square rounded-lg mb-2" alt={result.name} />
                                                <h4 className="font-bold text-sm truncate">{result.name}</h4>
                                                <p className="text-xs text-gray-400 truncate">{result.artist}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'chords' && currentTrack && (
                            <div className="space-y-4">
                                <h2 className="text-2xl font-bold mb-4">Cifras e Tablaturas</h2>
                                <div className="bg-white/5 p-4 rounded-lg">
                                    <h3 className="font-bold mb-2">{currentTrack.title} - {currentTrack.artist}</h3>
                                    <p className="text-sm text-gray-400 mb-4">Encontre cifras e tablaturas nos sites:</p>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <a href={`https://www.cifraclub.com.br/?q=${encodeURIComponent(currentTrack.artist + ' ' + currentTrack.title)}`} target="_blank" className="bg-yellow-600 hover:bg-yellow-500 p-3 rounded-lg text-center font-bold">üé∏ Cifra Club</a>
                                        <a href={`https://www.ultimate-guitar.com/search.php?search_type=title&value=${encodeURIComponent(currentTrack.title)}`} target="_blank" className="bg-orange-600 hover:bg-orange-500 p-3 rounded-lg text-center font-bold">üé∏ Ultimate Guitar</a>
                                        <a href={`https://tabs.ultimate-guitar.com/?q=${encodeURIComponent(currentTrack.artist + ' ' + currentTrack.title)}`} target="_blank" className="bg-red-600 hover:bg-red-500 p-3 rounded-lg text-center font-bold">üé∏ UG Tabs</a>
                                        <a href={`https://www.songsterr.com/?pattern=${encodeURIComponent(currentTrack.title)}`} target="_blank" className="bg-purple-600 hover:bg-purple-500 p-3 rounded-lg text-center font-bold">üé∏ Songsterr</a>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'lyrics' && currentTrack && (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold">{currentTrack.title}</h2>
                                    {!lyrics && <button onClick={() => fetchLyrics(currentTrack)} className="bg-white/10 px-4 py-2 rounded-lg">Carregar Letra</button>}
                                </div>
                                {loadingLyrics && <div className="text-center py-8">Carregando letra...</div>}
                                {lyrics && (
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div className="bg-white/5 p-4 rounded-lg">
                                            <h3 className="font-bold mb-3 text-yellow-500">Original</h3>
                                            <pre className="whitespace-pre-wrap text-sm">{lyrics.original}</pre>
                                        </div>
                                        <div className="bg-white/5 p-4 rounded-lg">
                                            <h3 className="font-bold mb-3 text-green-500">Tradu√ß√£o</h3>
                                            <pre className="whitespace-pre-wrap text-sm">{lyrics.traducao}</pre>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {showFullScreenPlayer && currentTrack && (
                        <div className="fixed inset-0 bg-black/95 z-50 flex flex-col">
                            <div className="p-6 flex justify-between">
                                <button onClick={() => setShowFullScreenPlayer(false)}><Icons.ChevronDown width={32} /></button>
                                <button onClick={() => fetchBandInfo(currentTrack.artist)} className="bg-white/10 px-4 py-2 rounded-lg">‚ÑπÔ∏è Sobre</button>
                            </div>
                            <div className="flex-1 flex items-center justify-center">
                                <img src={currentTrack.artwork} className={`w-80 h-80 vinyl-disc shadow-2xl ${isPlaying ? 'spin-slow' : ''}`} alt={currentTrack.title} />
                            </div>
                            <div className="p-8 space-y-4">
                                <div>
                                    <h2 className="text-2xl font-bold">{currentTrack.title}</h2>
                                    <p className={`text-lg ${themeColors[activeTheme]}`}>{currentTrack.artist}</p>
                                </div>

                                {/* Progress Bar */}
                                <div className="space-y-2">
                                    <input
                                        type="range"
                                        min="0"
                                        max={duration || 100}
                                        value={currentTime}
                                        onChange={(e) => setCurrentTime(Number(e.target.value))}
                                        className="w-full"
                                        style={{
                                            background: `linear-gradient(to right, white ${(currentTime / duration) * 100}%, rgba(255,255,255,0.2) ${(currentTime / duration) * 100}%)`
                                        }}
                                    />
                                    <div className="flex justify-between text-xs text-gray-400">
                                        <span>{formatTime(currentTime)}</span>
                                        <span>{formatTime(duration)}</span>
                                    </div>
                                </div>

                                {/* Controls */}
                                <div className="flex justify-center gap-6 items-center">
                                    <button onClick={playPrevious} className="text-white/70 hover:text-white">
                                        <Icons.SkipBack width={32} />
                                    </button>
                                    <button onClick={() => setIsPlaying(!isPlaying)} className="w-16 h-16 bg-white text-black rounded-full flex items-center justify-center">
                                        {isPlaying ? <Icons.Pause width={28} /> : <Icons.Play width={28} />}
                                    </button>
                                    <button onClick={playNext} className="text-white/70 hover:text-white">
                                        <Icons.Skip width={32} />
                                    </button>
                                </div>

                                {/* Volume */}
                                <div className="flex items-center gap-3">
                                    <Icons.Volume width={20} />
                                    <input
                                        type="range"
                                        min="0"
                                        max="100"
                                        value={volume}
                                        onChange={(e) => setVolume(Number(e.target.value))}
                                        className="flex-1"
                                        style={{
                                            background: `linear-gradient(to right, white ${volume}%, rgba(255,255,255,0.2) ${volume}%)`
                                        }}
                                    />
                                    <span className="text-xs w-8">{volume}%</span>
                                </div>
                            </div>
                            {currentTrack.youtubeId && (
                                <iframe ref={youtubeRef} className="hidden" src={getYoutubeEmbed()} allow="autoplay" />
                            )}
                        </div>
                    )}

                    {showBandInfo && bandInfo && (
                        <div className="fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4" onClick={() => setShowBandInfo(false)}>
                            <div className="bg-gray-900 rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <h2 className="text-2xl font-bold mb-4">‚ÑπÔ∏è Sobre {bandInfo.artist}</h2>
                                {bandInfo.loading ? <p>Carregando...</p> : <p className="whitespace-pre-wrap">{bandInfo.content}</p>}
                            </div>
                        </div>
                    )}

                    <div className="fixed bottom-4 left-4 right-4 z-40">
                        {currentTrack && !showFullScreenPlayer && (
                            <div onClick={() => setShowFullScreenPlayer(true)} className="mb-2 glass-nav rounded-lg p-2 flex items-center justify-between cursor-pointer">
                                <div className="flex items-center gap-3">
                                    <img src={currentTrack.artwork} className={`w-10 h-10 vinyl-disc ${isPlaying ? 'spin-slow' : ''}`} alt={currentTrack.title} />
                                    <div>
                                        <p className="text-sm font-bold truncate">{currentTrack.title}</p>
                                        <p className="text-xs text-green-400 truncate">{currentTrack.artist}</p>
                                    </div>
                                </div>
                                <button onClick={(e) => { e.stopPropagation(); setIsPlaying(!isPlaying); }}>
                                    {isPlaying ? <Icons.Pause width={20} /> : <Icons.Play width={20} />}
                                </button>
                            </div>
                        )}

                        <div className="glass-nav rounded-2xl h-16 flex items-center justify-around px-2">
                            <button onClick={() => setView('home')} className={`flex flex-col items-center gap-1 w-16 ${view === 'home' ? 'text-white' : 'text-gray-500'}`}>
                                <Icons.Home width={24} />
                                <span className="text-[10px]">In√≠cio</span>
                            </button>
                            <button onClick={() => setView('search')} className={`flex flex-col items-center gap-1 w-16 ${view === 'search' ? 'text-white' : 'text-gray-500'}`}>
                                <Icons.Search width={24} />
                                <span className="text-[10px]">Buscar</span>
                            </button>
                            <button onClick={() => setView('chords')} className={`flex flex-col items-center gap-1 w-16 ${view === 'chords' ? 'text-white' : 'text-gray-500'}`}>
                                <Icons.Guitar width={24} />
                                <span className="text-[10px]">Cifra</span>
                            </button>
                            <button onClick={() => setView('lyrics')} className={`flex flex-col items-center gap-1 w-16 ${view === 'lyrics' ? 'text-white' : 'text-gray-500'}`}>
                                <Icons.ABC width={24} />
                                <span className="text-[10px]">Letra</span>
                            </button>
                        </div>
                    </div>

                    {/* Context Menu */}
                    {contextMenu && (
                        <div
                            className="context-menu"
                            style={{ top: contextMenu.y, left: contextMenu.x }}
                            onClick={(e) => e.stopPropagation()}
                        >
                            <div className="context-menu-item" onClick={() => handlePlay(contextMenu.track)}>
                                ‚ñ∂Ô∏è Tocar
                            </div>
                            <div className="context-menu-item danger" onClick={() => deleteTrack(contextMenu.track)}>
                                üóëÔ∏è Excluir
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
